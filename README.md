# App Service

An application service based on [GetX](https://pub.dev/packages/get), which provides application-level management services, such as theme management, dark mode management and localization management.

![Alt text](studio64_5duUzsvaJV.gif)

![Alt text](example_wrJkq7TYlE.gif)



**Author:** [Jack Lee]()

**Email:** [291148484@163.com](291148484@163.com)

---

## 1. Getting Started

你可以使用`flutter pub add`命令在你的项目中安装**App Service**的最新版本：

```shell
flutter pub add app_seivice
```

这将在项目的`pubspec.yaml`文件的 `dependencies`字段中添加`app_seivice`作为依赖，并隐式地运行一次`flutter pub get`。



## 2. Managing App Service in dependency injection

In an actual project, there may be many dependencies to be managed besides AppService, so I like to create an injections.dart file to describe the dependencies.
The following example uses the [GetIt](https://pub.dev/packages/get_it) library to manage dependencies. You can also use other dependency management schemes, depending on your own habits.

```dart
import 'package:app_service/app_service.dart';
import 'package:get_it/get_it.dart';

/// 基于 Get it 库的依赖注入
class GetitInjection {
  static void init() {
    final GetIt i = GetIt.instance;
    AppService appService = AppService(
      supportedLanguages: const [
        LanguageEnum.zh,
        LanguageEnum.en,
      ],
      defaultLang: LanguageEnum.zh,
    );
    i.registerLazySingleton<AppService>(() => appService); 
  }
}
```



### 2.1 Theme Management

#### summary

Theme management in application service is used to switch different color themes, and each theme contains two modes, namely dark mode and light mode.
There are many theme data generated by [flex_color_scheme](https://pub.dev/packages/flex_color_scheme) built into the library.

#### Built-in themes


Certainly! Here are the English versions of the Theme Names with only three columns:

| Theme Name | Light Theme | Dark Theme |
|------------|--------------|-------------|
| amberBlue   | amberBlueLightTheme | amberBlueDarkTheme |
| aquaBlue    | aquaBlueLightTheme | aquaBlueDarkTheme |
| bahamaTrinidad | bahamaTrinidadLightTheme | bahamaTrinidadDarkTheme |
| barossa     | barossaLightTheme | barossaDarkTheme |
| bigStoneTulip  | bigStoneTulipLightTheme | bigStoneTulipDarkTheme |
| blueDelight  | blueDelightLightTheme | blueDelightDarkTheme |
| blueStoneTeal | blueStoneTealLightTheme | blueStoneTealDarkTheme |
| blueWhale    | blueWhaleLightTheme | blueWhaleDarkTheme |
| blumine      | blumineLightTheme | blumineDarkTheme |
| brandBlue    | brandBlueLightTheme | brandBlueDarkTheme |
| brownOrange  | brownOrangeLightTheme | brownOrangeDarkTheme |
| camaroneGreen | camaroneGreenLightTheme | camaroneGreenDarkTheme |
| damaskLunar  | damaskLunarLightTheme | damaskLunarDarkTheme |
| deepBlueSea  | deepBlueSeaLightTheme | deepBlueSeaDarkTheme |
| deepPurple   | deepPurpleLightTheme | deepPurpleDarkTheme |
| dellGenoaGreen | dellGenoaGreenLightTheme | dellGenoaGreenDarkTheme |
| ebonyClay    | ebonyClayLightTheme | ebonyClayDarkTheme |
| eggplantPurple | eggplantPurpleLightTheme | eggplantPurpleDarkTheme |
| endeavourBlue | endeavourBlueLightTheme | endeavourBlueDarkTheme |
| espressoCrema | espressoCremaLightTheme | espressoCremaDarkTheme |
| flutterDash  | flutterDashLightTheme | flutterDashDarkTheme |
| goldSunset   | goldSunsetLightTheme | goldSunsetDarkTheme |
| greens      | greensLightTheme | greensDarkTheme |
| greenForest  | greenForestLightTheme | greenForestDarkTheme |
| greenJungle  | greenJungleLightTheme | greenJungleDarkTheme |
| greenMoney   | greenMoneyLightTheme | greenMoneyDarkTheme |
| greyLaw      | greyLawLightTheme | greyLawDarkTheme |
| hippieBlue   | hippieBlueLightTheme | hippieBlueDarkTheme |
| indigoNight  | indigoNightLightTheme | indigoNightDarkTheme |
| indigoSanMarino | indigoSanMarinoLightTheme | indigoSanMarinoDarkTheme |
| lipstickPink | lipstickPinkLightTheme | lipstickPinkDarkTheme |
| mallardValencia | mallardValenciaLightTheme | mallardValenciaDarkTheme |
| mangoMojito  | mangoMojitoLightTheme | mangoMojitoDarkTheme |
| material3   | material3LightTheme | material3DarkTheme |
| material3HighContrast | material3HighContrastLightTheme | material3HighContrastDarkTheme |
| material3Purple | material3PurpleLightTheme | material3PurpleDarkTheme |
| midnight    | midnightLightTheme | midnightDarkTheme |
| mosqueCyan   | mosqueCyanLightTheme | mosqueCyanDarkTheme |
| ohMandyRed   | ohMandyRedLightTheme | ohMandyRedDarkTheme |
| outerSpace   | outerSpaceLightTheme | outerSpaceDarkTheme |
| pinkSakura   | pinkSakuraLightTheme | pinkSakuraDarkTheme |
| purpleBrown  | purpleBrownLightTheme | purpleBrownDarkTheme |
| redBlue      | redBlueLightTheme | redBlueDarkTheme |
| redTornado   | redTornadoLightTheme | redTornadoDarkTheme |
| redWine      | redWineLightTheme | redWineDarkTheme |
| rosewood     | rosewoodLightTheme | rosewoodDarkTheme |
| rustDeepOrange | rustDeepOrangeLightTheme | rustDeepOrangeDarkTheme |
| sanJuanBlue  | sanJuanBlueLightTheme | sanJuanBlueDarkTheme |
| sharkOrange  | sharkOrangeLightTheme | sharkOrangeDarkTheme |
| thunderbirdRed | thunderbirdRedLightTheme | thunderbirdRedDarkTheme |
| verdunGreen  | verdunGreenLightTheme | verdunGreenDarkTheme |
| verdunLime   | verdunLimeLightTheme | verdunLimeDarkTheme |
| vesuviusBurned | vesuviusBurnedLightTheme | vesuviusBurnedDarkTheme |
| willowWasabi | willowWasabiLightTheme | willowWasabiDarkTheme |
| yukonGoldYellow | yukonGoldYellowLightTheme | yukonGoldYellowDarkTheme |

### 2.2 Dark Mode Management

在 `App Service` 库中，Dark/Light 模式是同一主题下的两个子状态，本质上是定义了两组对应的主题数据。你可以直接在AppSeivice的单例中，通过 `toggleDarkMode` 方法切换暗黑模式：

```dart
// 获取 AppService 单例
final AppService appService = GetIt.instance.get<AppService>();
// 切换暗黑模式
appService.toggleDarkMode()
```

### 3. Localization

**Messages**是一个翻译容器，它接受一个列表，可以用来包含多个翻译。其类型签名为：

```dart
Messages Messages(
    List<Map<String, Map<String, String>>> translations
)
```

你应该在顶级组件 **GetMaterialApp** 中通过`translations`参数传入它，并且必须在列表中包含一个`AppServiceMessages().keys`，这是一份用于**App Service**的翻译文件。例如：

```dart
GetMaterialApp(
  translations: Messages([
    AppServiceMessages().keys,
    // 其它翻译
    HomeMessages().keys,
  ]),
);
```

其中，**HomeMessages**是一个假定的自定义翻译文件，它看起来像这样：

```dart
import 'package:get/get.dart';

class HomeMessages extends Translations {
  @override
  Map<String, Map<String, String>> get keys => {
        'zh_CN': {
          'home.appService_demo': 'AppService 演示',
        },
        'en': {
          'home.appService_demo': 'AppService Demo',
        },
        'ko_KR': {
          'home.appService_demo': 'AppService 데모',
        },
        'ja_JP': {
          'home.appService_demo': 'AppService デモ',
        },
        // More language translate...
      };
}
```

当然，依据项目的需要你可以定义更多这样的翻译文件，并在**Messages**的`translations`列表中加载。

实现国际化时，定义支持的多种语言是通过构造**AppService**的`supportedLanguages`参数指定的，它接受由多个**LanguageEnum** 枚举值所构成的列表。**AppService**还需要指定一个默认的语言。例如：

```dart
AppService appService = AppService(
  supportedLanguages: const [
    LanguageEnum.zh,
    LanguageEnum.en,
    LanguageEnum.fr,
  ],
  defaultLang: LanguageEnum.zh,
);
```

其中，`defaultLang`的默认值为 *LanguageEnum.en*。这里的定义需要与顶层组件中的`locale`参数对应。

应用标题是不能使用**GetX**提供的`.tr`来实现翻译的，因为在顶层组件初始化完成之前该方法不可用。这在 **Web** 端的本地化切换效果尤为明显：

![chrome_0ywly93CSl](./README.assets/chrome_0ywly93CSl.gif)

为了实现这种动态切换，你可以像我一样使用一个`switch`语句，下面是一个示例：

```dart
import 'package:app_service/app_service.dart';

// ...
GetMaterialApp(
  // ...
  title: switch (Get.locale?.languageCode) {
    'zh' => 'AppService 演示',
    'en' => 'AppService Demo',
    'fr' => 'AppService démonstration',
    'ja' => 'AppServiceデモ',
    'ko' => 'App 서비스 데모',
    'ar' => 'تطبيق AppService',
    _ => 'AppService Demo',
  },
  translations: Messages([
    AppServiceMessages().keys,
    HomeMessages().keys,
  ]),
  locale: const Locale('zh', 'CN'),
  fallbackLocale: const Locale('en', 'US'),
  home: const HomeView(),
);

```



## 3. Initialization

初始化用于从持久化的数据中读取用户上一次存储的数据。在**AppService** 实例上提供了一个`init`方法用于完成其自身的相关初始化工作。

在你的应用中，可以使用多种方式完成初始化，例如，下面的代码展示了通过顶层组件**GetMaterialApp**的`onInit`方法实现初始化：

```dart
// ...
void main() async {
  runApp(const MyApp());
}

class MyApp extends StatelessWidget {
  const MyApp({super.key});

  Future<void> onInit(BuildContext context) async {
    // Init AppService
    final appService = GetIt.instance.get<AppService>();
    await appService.init();
    // ...Other initializations
  }

  @override
  Widget build(BuildContext context) {
    final appService = GetIt.instance.get<AppService>();

    return GetMaterialApp(
      // ...
      onInit: () async {
        await onInit(context);
      },
    );
  }
}
```





## 4. Web App

在 Web App 中，当前的 [sharedPreferencesWeb](https://pub.dev/packages/shared_preferences_web) 库通过 [localStorage](https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage) 实现键值对存储。如果改变 AppService 所管理的相关状态，这些变化将直接反映在浏览器的 localStorage 中：

![Alt text](chrome_aQ4vYWZSYM.gif)





## 5. Example App

你可以在中找到 **App Service** 的示例应用。



## 6. Issue Tracker

你可以在 Github 上报告错误：https://github.com/jacklee1995/flutter_app_service/issues



## 7. licence

This project is licensed under the MIT License - see the [LICENSE](https://github.com/jacklee1995/flutter_app_service/blob/master/LICENSE) file for details.

本项目根据MIT许可证许可 - 有关详细信息，请参阅[LICENSE](https://github.com/jacklee1995/flutter_app_service/blob/master/LICENSE)文件。





---



各个版本所依赖的 **GetX** 推荐版本如下表所示：

| App Service | GetX |
| :---------- | :--- |
| 1.0.0       | 4.6  |

版本相差不大都可以通用。